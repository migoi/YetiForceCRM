
jQuery.Class("Install_Index_Js",{fieldsCached:["db_hostname","db_username","db_name","create_db","db_root_username","currency_name","firstname","lastname","admin_email","dateformat","timezone"],checkUsername:function(d,e,c,b){var a=jQuery.parseJSON(jQuery('input[name="not_allowed_logins"]').val());if(jQuery.inArray(d.val(),a)!==-1){return app.vtranslate("LBL_INVALID_USERNAME_ERROR")}},},{registerEventForStep1:function(){jQuery(".bt_install").on("click",function(a){jQuery('input[name="mode"]').val("step2");jQuery('form[name="step1"]').submit()});jQuery(".bt_migrate").on("click",function(a){jQuery('input[name="mode"]').val("mStep0");jQuery('form[name="step1"]').submit()})},registerEventForStep3:function(){jQuery("#recheck").on("click",function(){window.location.reload()});jQuery('input[name="step4"]').on("click",function(b){var a=jQuery(".no");if(a.length>0){var c=app.vtranslate("LBL_PHP_WARNING");if(confirm(c)){jQuery('form[name="step3"]').submit();return true}else{return false}}jQuery('form[name="step3"]').submit()})},checkPwdEvent:function(){var a=this;jQuery('input[name="password"]').on("blur",function(){a.checkPwd(jQuery(this).val())})},checkPwd:function(b){var a=false;if(b.length<8){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_TO_SHORT"));a=true}else{if(b.length>32){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_TO_LONG"));a=true}else{if(b.search(/\d/)==-1){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_NO_NUM"));a=true}else{if(b.search(/[A-Z]/)==-1){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_LACK_OF_CAPITAL_LETTERS"));a=true}else{if(b.search(/[a-z]/)==-1){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_LACK_OF_LOWERCASE_LETTERS"));a=true}}}}}return a},registerEventForStep4:function(){var b=JSON.parse(localStorage.getItem("yetiforce_install"));Install_Index_Js.fieldsCached.forEach(function(f){if(b&&typeof b[f]!=="undefined"){var e=jQuery('[name="'+f+'"]');if("SELECT"==jQuery(e).prop("tagName")){jQuery(e).val(b[f]);jQuery(e).select2("destroy");jQuery(e).select2()}else{if("INPUT"==jQuery(e).prop("tagName")&&"checkbox"==jQuery(e).attr("type")){if(true==b[f]){jQuery(e).prop("checked",true);jQuery(".config-table tr.hide").removeClass("hide")}}else{jQuery(e).val(b[f])}}}});var c=this;jQuery('input[name="create_db"]').on("click",function(){var f=jQuery("#root_user");var e=jQuery("#root_password");if(jQuery(this).is(":checked")){f.removeClass("hide");e.removeClass("hide")}else{f.addClass("hide");e.addClass("hide")}});function d(){jQuery("#passwordError").html("")}function a(){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_REENTER_ERROR"))}jQuery('input[name="retype_password"]').on("blur",function(h){var g=jQuery(h.currentTarget);var f=jQuery('input[name="password"]').val();if(f!==g.val()){a()}});jQuery('input[name="password"]').on("blur",function(g){var f=jQuery('input[name="retype_password"]');if(f.val()!=""&&f.val()!==jQuery(g.currentTarget).val()){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_REENTER_ERROR"))}else{d()}});jQuery('input[name="retype_password"]').on("keypress",function(f){d()});jQuery('input[name="step5"]').on("click",function(){var h=false;var e=["db_hostname","db_username","db_name","password","retype_password","lastname","admin_email"];for(var p in e){var m=jQuery('input[name="'+e[p]+'"]');if(m.val()==""){m.addClass("error").focus();h=true;break}else{m.removeClass("error")}}var q=jQuery('input[name="create_db"]:checked');if(q.length>0){var k=jQuery('input[name="db_root_username"]');if(k.val()==""){k.addClass("error").focus();h=true}else{k.removeClass("error")}}var n=jQuery("#passwordError");if(n.html().trim()){h=true}var o=jQuery('input[name="admin_email"]');var j=false;var l=/^[_/a-zA-Z0-9*]+([!"#$%&'()*+,./:;<=>?\^_`{|}~-]?[a-zA-Z0-9/_/-])*@[a-zA-Z0-9]+([\_\-\.]?[a-zA-Z0-9]+)*\.([\-\_]?[a-zA-Z0-9])+(\.?[a-zA-Z0-9]+)?$/;if(!l.test(o.val())&&o.val()!=""){j=true;o.addClass("error").focus();h=true}else{o.removeClass("error")}var i=false;i=c.checkPwd(jQuery('input[name="password"]').val());if(i){h=true}if(h){var g;if(j){g='<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+jQuery('[name="invalidEmailError"]').val()+"</div></div>"}else{if(i){g='<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+jQuery('[name="insufficientlyStrongPassword"]').val()+"</div></div>"}else{g='<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+app.vtranslate("LBL_MANDATORY_FIELDS_ERROR")+"</div></div>"}}jQuery("#errorMessage").html(g).show()}else{var f={db_hostname:document.step4.db_hostname.value,db_username:document.step4.db_username.value,db_name:document.step4.db_name.value,create_db:jQuery('[name="create_db"]').prop("checked"),db_root_username:document.step4.db_root_username.value,currency_name:document.step4.currency_name.value,firstname:document.step4.firstname.value,lastname:document.step4.lastname.value,admin_email:document.step4.admin_email.value,dateformat:document.step4.dateformat.value,timezone:document.step4.timezone.value};window.localStorage.setItem("yetiforce_install",JSON.stringify(f));jQuery('form[name="step4"]').submit()}});this.checkPwdEvent()},registerEventForStep5:function(){jQuery('input[name="step6"]').on("click",function(){var a=jQuery("#errorMessage");if(a.length){alert(app.vtranslate("LBL_RESOLVE_ERROR"));return false}else{jQuery("#progressIndicator").removeClass("hide");jQuery('form[name="step5"]').submit().hide()}})},registerEventForStep6:function(){jQuery('input[name="step7"]').on("click",function(){if($('form[name="step6"]').validationEngine("validate")){jQuery("#progressIndicator").show().removeClass("hide");jQuery('form[name="step6"]').submit().hide()}})},registerEventForMigration:function(){var a=jQuery('input[name="mode"]').val();if(a=="mStep3"){jQuery("form").on("submit",function(){jQuery("#progressIndicator").show();jQuery("#mainContainer").hide()})}},changeLanguage:function(b){var a=$(b.currentTarget);jQuery('input[name="mode"]').val("step1");jQuery('form[name="step1"]').submit()},registerEvents:function(){jQuery('input[name="back"]').on("click",function(){var a=jQuery('input[name="create_db"]:checked');if(a.length>0){jQuery('input[name="create_db"]').removeAttr("checked")}window.history.back()});jQuery("form").validationEngine(app.validationEngineOptions);this.registerEventForStep1();this.registerEventForStep3();this.registerEventForStep4();this.registerEventForStep5();this.registerEventForStep6();this.registerEventForMigration();$('select[name="lang"]').change(this.changeLanguage)}});jQuery(document).ready(function(){var a=new Install_Index_Js();a.registerEvents()});
